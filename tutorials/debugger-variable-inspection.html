<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    
    <!-- Favicon -->
    <link rel="icon" href="/img/favicons/favicon.ico">

    <!-- Add to homescreen for Chrome on Android -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="Truffle Suite">
    <link rel="icon" sizes="192x192" href="/img/favicons/chrome-touch-icon-192x192.png">

    <!-- Add to homescreen for Safari on iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="Truffle Suite">
    <link rel="apple-touch-icon" href="/img/favicons/apple-touch-icon.png">

    <!-- Tile icon for Win8/10 (144x144 + tile color) -->
    <meta name="msapplication-TileImage" content="img/favicons/ms-touch-icon-144x144-precomposed.png">
    <meta name="msapplication-TileColor" content="#3372DF">

    <!-- Facebook OpenGraph -->
    <meta property="og:site_name" content="Truffle Suite" />
    <meta property="og:description" content="The Truffle suite of tools make dapp development easier and more consistent." />
    <meta property="og:title" content="Truffle Suite | Tutorials | Variable Inpsection: Going Deeper with the Truffle Solidity Debugger" />
    <meta property="og:url" content="https://trufflesuite.com/tutorials/debugger-variable-inspecti" />
    <meta property="og:type" content="article" />
    <meta property="og:image" content="https://truffleframework.com/img/favicons/truffle-share.png" />

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="Truffle Suite" />
    <meta name="twitter:title" content="Truffle Suite | Tutorials | Variable Inpsection: Going Deeper with the Truffle Solidity Debugger" />
    <meta name="twitter:description" content="The Truffle suite of tools make dapp development easier and more consistent." />
    <meta name="twitter:creator" content="Truffle Suite" />
    <meta name="twitter:domain" content="trufflesuite.com" />
    <meta name="twitter:image:src" content="https://truffleframework.com/img/favicons/truffle-share.png" />
    
    <meta name="google-site-verification" content="BSgPkMHzw7IxJTpEElNfD8ZZYPzXgOQiTVPzAxAG8-o" />
      
    <title>Truffle Suite | Tutorials | Variable Inpsection: Going Deeper with the Truffle Solidity Debugger</title>

    <link href="https://fonts.googleapis.com/css?family=Grand+Hotel|Open+Sans|Oswald|Varela+Round|Roboto+Condensed|Roboto+Mono" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.9/css/all.css" integrity="sha384-5SOiIsAziJl6AWe0HWRKTXlfcSHKmYV4RBF18PPJ173Kzn7jzMyFuTtk8JA7QQG1" crossorigin="anonymous">
    <link rel="stylesheet" href="/css/index.css">
  </head>
  <body>
    <nav class="navbar navbar-expand-md navbar-dark fixed-top" id="primaryNav">
      <a class="navbar-brand current" href="/">
        <img class="suite-logo" src="/img/truffle-logomark.svg" alt="Truffle Logo" />TRUFFLE SUITE
      </a>
    
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarsExampleDefault" aria-controls="navbarsExampleDefault" aria-expanded="false" aria-label="Toggle navigation">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    
      <div class="collapse navbar-collapse" id="navbarsExampleDefault">
        <ul class="navbar-nav ml-auto">
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" id="suiteDropdown" href="#" data-toggle="dropdown">SUITE</a>
    
            <div class="dropdown-menu">
              <a class="text-truffle" href="/truffle">
                <img class="suite-logo" src="/img/truffle-logomark.svg" alt="Truffle Logo" /><span class="narrow">T</span>RUFFLE
              </a>
              <a class="text-ganache" href="/ganache">
                <img class="suite-logo" src="/img/ganache-logomark.svg" alt="Ganache Logo" />Ganache
              </a>
              <a class="text-drizzle" href="/drizzle">
                <img class="suite-logo" src="/img/drizzle-logomark.svg" alt="Drizzle Logo" />dri<span class="drizzle-z-skew-1">z</span><span class="drizzle-z-skew-2">z</span>le
              </a>
            </div>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/docs">DOCS</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/tutorials">TUTORIALS</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/boxes">BOXES</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/blog">BLOG</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/community">COMMUNITY</a>
          </li>
        </ul>
      </div>
    </nav>
    <main class="container container-heading container-narrow">
      <div class="row">
        <div class="col">
          <h1>Variable Inpsection: Going Deeper with the Truffle Solidity Debugger</h1>
          <ul class="list-sm-stacker space-icon mb-0">
            <li><i class="far fa-calendar-alt"></i> 2018-05-07&nbsp;&nbsp;&nbsp;</li>
            <li><i class="far fa-user"></i> Mike Pumphrey</li>
          </ul>
        </div>
      </div>
    </main>

    <main class="banner banner-light-cream pt-5 pb-5" role="main">
      <div class="container container-post">
        <div class="row justify-content-center">
          <div class="col">
            
    <h1 class="link-markdown">
      <a href="#variable-inspection-going-deeper-with-the-truffle-solidity-debugger" name="variable-inspection-going-deeper-with-the-truffle-solidity-debugger"><i class="fas fa-link"></i></a>
      Variable inspection: Going deeper with the Truffle Solidity debugger
    </h1>
  <p class="alert alert-info">
  <strong>Note</strong>: This tutorial requires Truffle version 4.1.8 or newer.
</p>

<p>The integrated Solidity debugger in Truffle is a powerful tool for inspecting your contracts. </p>
<p>When initially released, the debugger had the ability to to step through Solidity code, but that was it.</p>
<p>But development has continued apace, and new functionality has been added to make your contract inspection more powerful. Specifically, <strong>you now have the ability to perform variable inspection on your contracts</strong>. With this, you can know exactly the state of your variables at every given point in the instruction list, giving you a much greater ability to truly inhabit the current state of your contracts, and making debugging a breeze.</p>
<p>In this tutorial, we&#39;re going to take a look at a simple contract and inspect it using the Truffle Solidity debugger. We&#39;ll investigate three scenarios:</p>
<ol>
<li>A working contract</li>
<li>A working contract with unexpected output</li>
<li>A broken contract</li>
</ol>

    <h2 class="link-markdown">
      <a href="#a-basic-smart-contract" name="a-basic-smart-contract"><i class="fas fa-link"></i></a>
      A basic smart contract
    </h2>
  <p>The Fibonacci sequence is an integer sequence where each successive number in the sequence is the sum of the two previous numbers.</p>
<p>With the first two numbers set to 1, you can determine every number in the sequence through iteration.</p>
<p>The Fibonacci sequence is related to the &quot;golden ratio&quot;, which is found in certain areas of nature, such as governing the the arrangement of leaves on branches and petals on flowers.</p>
<p>
    <img class="img-fluid" src="/img/tutorials/debugger-variable/flower-golden-ratio.jpg" title="Golden ratio" alt="Golden ratio" />
    
  </p>
<p><em>The golden ratio in nature: flower petals. (Source: <a href="https://flic.kr/p/ybkmLC">Flickr</a>)</em></p>
<p>Generating the Fibonacci sequence with a smart contract can show off the debugger and its variable inspection without getting too bogged down in details. Let&#39;s do it.</p>
<ol>
<li><p>Create a new project directory called <code>fibonacci</code> and change into it.</p>
<pre><code class="lang-shell">mkdir fibonacci
cd fibonacci
</code></pre>
</li>
<li><p>Create a bare truffle project:</p>
<pre><code class="lang-shell">truffle init
</code></pre>
</li>
<li><p>In the <code>contracts/</code> directory, create a file named <code>Fibonacci.sol</code> and add the following content:</p>
<pre><code class="lang-javascript">pragma solidity ^0.4.22;

contract Fibonacci {

uint[] fibseries;

  // n = how many in the series to return
  function generateFib(uint n) public {

    // set 1st and 2nd entries
    fibseries.push(1);
    fibseries.push(1);

    // generate subsequent entries
    for (uint i=2; i &lt; n ; i++) {
      fibseries.push(fibseries[i-1] + fibseries[i-2]);
    }

  }

}
</code></pre>
<p>Let&#39;s take a look at this contract to see what&#39;s going on with it:</p>
<ul>
<li>First, we see the standard <code>pragma</code> declaration, which states that the contract s compatible with any 0.4.x version of Solidity newer than 0.4.22.</li>
<li>The contract name is called <code>Fibonacci</code>.</li>
<li>We&#39;re defining an array of integers called <code>fibseries</code>. This will house our Fibonacci series. Note that the variable declaration is happening <em>outside</em> of any function, and therefore the array will be saved in storage (instead of memory), provoking a transaction to occur when the contract is run.</li>
<li>The function is called <code>generateFib</code> and takes a single argument, which is the number of integers in the sequence to generate.</li>
<li>The next two commands add an element each to the array via the <code>.push()</code> method. As we know our <code>fibseries</code> array is defined in storage, but size isn&#39;t known until runtime, the <code>.push()</code> method is used to add entries to (the end of) our array. This starts the sequence with the number 1 twice.</li>
<li>The for loop iterates through the rest of the array (as determined by the integer <code>n</code>) filling each entry with the appropriate value.</li>
</ul>
</li>
<li><p>Inside the <code>migrations/</code> directory of your project, create a file called <code>2_deploy_contracts.js</code> and populate it with the following content:</p>
<pre><code class="lang-javascript">var Fibonacci = artifacts.require(&quot;Fibonacci&quot;);

module.exports = function(deployer) {
  deployer.deploy(Fibonacci);
};
</code></pre>
<p>This file allows us to deploy the <code>Fibonacci</code> contract (shown above) to the blockchain.</p>
</li>
<li><p>Now launch <a href="/ganache">Ganache</a>. This will be the personal blockchain we&#39;ll use to deploy our contract.</p>
<p>
    <img class="img-fluid" src="/img/tutorials/debugger-variable/debugvar-ganache-initial.png" title="Ganache" alt="Ganache" />
    
  </p>
<p><em>Ganache</em></p>
<p class="alert alert-info">
  <strong>Note</strong>: You can also run this tutorial with <a href="/docs/getting_started/console">Truffle Develop</a> and the results will be the same.
</p>
</li>
<li><p>In the root of your project, open your <code>truffle.js</code> file and add the following content:</p>
<pre><code class="lang-javascript">module.exports = {
  networks: {
    development: {
      host: &quot;127.0.0.1&quot;,
      port: 7545,
      network_id: &quot;*&quot;
    }
  }
};
</code></pre>
<p>This allows us to connect our project to Ganache.</p>
</li>
<li><p>Launch the <a href="/docs/getting_started/console">Truffle console</a>:</p>
<pre><code class="lang-shell">truffle console
</code></pre>
<p>You will see a prompt:</p>
<pre><code>truffle(development)&gt;
</code></pre><p>We&#39;ll run all of our commands from here.</p>
</li>
<li><p>Compile the contract:</p>
<pre><code class="lang-shell">compile
</code></pre>
<p>You should see the following output:</p>
<pre><code>Compiling .\contracts\Fibonacci.sol...
Compiling .\contracts\Migrations.sol...
Writing artifacts to .\build\contracts
</code></pre><p class="alert alert-info">
  <strong>Note</strong>: Make sure to examine the output for any errors or warnings.
</p>

<!--TODO: Update Migrations.sol template to eliminate constructor warning-->
</li>
<li><p>Migrate the contract to our blockchain. </p>
<pre><code class="lang-shell">migrate
</code></pre>
<p>You will see output that looks like this, though the addresses and transaction IDs will be different:</p>
<pre><code>Using network &#39;development&#39;.

Running migration: 1_initial_migration.js
  Replacing Migrations...
  ... 0xd29465deee7a5d60aed89520807432ef8a2fbbb665611882277ec8ca6fc9c622
  Migrations: 0x5cc77b19b8e14e4d6074562bdbe1e13e1b793693
Saving successful migration to network...
  ... 0xba700ad46880ab2a9bdd961e66c9313fc541f91c439243df6ab2b97920cf2c4a
Saving artifacts...
Running migration: 2_deploy_contracts.js
  Replacing Fibonacci...
  ... 0xed0d1b736e948d926ee31f959b013f67d71e08f294a87e86e41ccbd8a62ce908
  Fibonacci: 0xa3f4063ffbdc5cfd8ecbd99424378a5f056eb81d
Saving successful migration to network...
  ... 0xcaeb44f5e28689c29cb3189c7b42fa1094021b4e5008f720fef2f9b867e6be23
Saving artifacts...
</code></pre></li>
</ol>

    <h2 class="link-markdown">
      <a href="#interacting-with-the-basic-smart-contract" name="interacting-with-the-basic-smart-contract"><i class="fas fa-link"></i></a>
      Interacting with the basic smart contract
    </h2>
  <p>Our contract is now on the blockchain. Ganache has automatically mined the transactions that came from the contract call and creation, as you can see by clicking the &quot;Transactions&quot; button in Ganache:</p>
<p>
    <img class="img-fluid" src="/img/tutorials/debugger-variable/debugvar-ganache-transactions.png" title="Ganache transactions" alt="Ganache transactions" />
    
  </p>
<p><em>Ganache transactions</em></p>
<p>Now it&#39;s time to interact with the contract. First we&#39;ll check to make sure that it&#39;s working correctly.</p>
<ol>
<li><p>In the Truffle console, enter the following command:</p>
<pre><code class="lang-shell">Fibonacci.deployed().then(function(instance){return instance.generateFib(10);});
</code></pre>
<p>Before we run the command, let&#39;s take a look at it in greater detail. Displayed in a more easily-readable manner, it reads:</p>
<pre><code class="lang-shell">Fibonacci.deployed().then(function(instance) {
  return instance.generateFib(10);
});
</code></pre>
<p>This command uses <a href="https://www.promisejs.org/">JavaScript promises</a>. Specifically, the command says that given a deployed version of the Fibonacci contract, run an instance of that contract, and then run the <code>generateFib</code> function from that contract, passing it the argument <code>10</code>.</p>
</li>
<li><p>Run the above command. A transaction will be created on the blockchain because our array that holds the generated Fibonacci sequence is in storage. Because of this, the output of the console will be the transaction details, which will look similar to this:</p>
<pre><code>{ tx: &#39;0xf47f01da1a6991f4dc168928cf4c490cb9bb57ca403b428f40a333ea65d1c41c&#39;,
  receipt:
   { transactionHash: &#39;0xf47f01da1a6991f4dc168928cf4c490cb9bb57ca403b428f40a333ea65d1c41c&#39;,
     transactionIndex: 0,
     blockHash: &#39;0x88d45cb84d1f26001b0e7ae2931a56dfc0a592a1d0437fe0a37540d65f49a2ed&#39;,
     blockNumber: 5,
     gasUsed: 298373,
     cumulativeGasUsed: 298373,
     contractAddress: null,
     logs: [],
     status: &#39;0x01&#39;,
     logsBloom: &#39;0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000&#39; },
  logs: [] }
</code></pre><p>The important part of this output for us is the transaction ID (listed as the value of <code>tx:</code>). Because even though we&#39;ve run our function, we don&#39;t actually know what happened. Did it work correctly? Did something unexpected happen? We&#39;ll need the Truffle Solidity debugger to find out.</p>
<p class="alert alert-info">
  <strong>Note</strong>: Your transaction ID will be different from the above.
</p>

</li>
</ol>

    <h2 class="link-markdown">
      <a href="#debugging-a-transaction" name="debugging-a-transaction"><i class="fas fa-link"></i></a>
      Debugging a transaction
    </h2>
  <p>You can debug a transaction in the Truffle console by typing <code>debug &lt;transactionID&gt;</code>. We&#39;ll now do just that.</p>
<ol>
<li><p>Type <code>debug</code> and then the value of <code>tx:</code> found in your transaction details. For example:</p>
<pre><code class="lang-shell">debug 0xf47f01da1a6991f4dc168928cf4c490cb9bb57ca403b428f40a333ea65d1c41c
</code></pre>
<p class="alert alert-warning">
  <strong>Note</strong>: Your transaction ID will be different. Do not copy the above example exactly.
</p>

<p>This will enter the debugger. You will see the following output:</p>
<pre><code>Gathering transaction data...

Addresses affected:
 0x33b217190208f7b8d2b14d7a30ec3de7bd722ac6 - Fibonacci

Commands:
(enter) last command entered (step next)
(o) step over, (i) step into, (u) step out, (n) step next
(;) step instruction, (p) print instruction, (h) print this help, (q) quit
(b) toggle breakpoint, (c) continue until breakpoint
(+) add watch expression (`+:&lt;expr&gt;`), (-) remove watch expression (-:&lt;expr&gt;)
(?) list existing watch expressions
(v) print variables and values, (:) evaluate expression - see `v`

Fibonacci.sol:

1: pragma solidity ^0.4.22;
2:
3: contract Fibonacci {
   ^^^^^^^^^^^^^^^^^^^^

debug(development:0xf47f01da...)&gt;
</code></pre><p>Let&#39;s examine what&#39;s going on here.</p>
<ul>
<li>The debugger names the address of the contract in question that is related to the transaction, as well as the name of that contract. In our case, we&#39;re only dealing with a single contract, though if our transaction dealt with multiple contracts, all addresses would be shown.</li>
<li>A full list of commands for the debugger is shown. Many of these mirror other code debuggers. We&#39;ll use a few of these throughout the tutorial, but if you ever want to see the list again, type <code>h</code>.</li>
<li>The debugger starts at the first instruction of the transaction, and shows you the relevant code for that instruction, highlighted with carets (<code>^^^</code>).</li>
</ul>
</li>
<li><p>Type <code>n</code> and <code>&lt;Enter&gt;</code> to step next. This will move to the next instruction:</p>
<pre><code>6:
7:   // n = how many in the series to return
8:   function generateFib(uint n) public {
     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

debug(development:0xf47f01da...)&gt;
</code></pre></li>
<li><p>We&#39;ve seen in the <a href="/tutorials/debugging-a-smart-contract">previous tutorial on debugging</a> how you can step through the instructions to debug your contract. But here, we have an additional concern, which is that we don&#39;t actually know the outcome of our function call; we want to know what a <em>variable</em> is set to. You can view the state of all known variables by pressing <code>v</code>:</p>
<pre><code>  fibseries: []

debug(development:0xf47f01da...)&gt;
</code></pre><p>Here we see one empty array. The arry <code>fibseries</code> will have the <code>n</code> numbers in the Fibonacci sequence.</p>
</li>
<li><p>Press <code>Enter</code> to repeat the last command, and step next to the next instruction:</p>
<pre><code> 9:
10:     // set 1st and 2nd entries
11:     fibseries.push(1);
        ^^^^^^^^^

debug(development:0xf47f01da...)&gt;
</code></pre><p>This instruction moves on to the initial seeding of the <code>fibseries</code> variable.</p>
</li>
<li><p>Press <code>v</code> to see the current state of the variables:</p>
<pre><code>          i: 0
          n: 10
  fibseries: []
</code></pre><p>Now we see three variables, our <code>fibseries</code> array and two others: </p>
<ul>
<li><code>i</code> is an index variable, used to determine the location of the next number in the sequence</li>
<li><code>n</code> is the integer we passed to the function (<code>10</code> in this case) indicating the number of entries in our Fibonacci sequence</li>
</ul>
<p>Here we see that <code>n</code> has been passed the value from the contract, while <code>i</code> hasn&#39;t received its value from the for loop yet, since we haven&#39;t gotten to that part of the function.</p>
</li>
<li><p>Press <code>Enter</code> to step next to the next instruction:</p>
<pre><code> 9:
10:     // set 1st and 2nd entries
11:     fibseries.push(1);
                       ^
</code></pre></li>
<li><p>It&#39;s rather tedious to constantly press <code>v</code> after every state change. Thankfully, you can set certain variables to be &quot;watched&quot;, so that they will display after every movement in the debugger. The syntax to watch a variable is <code>+:&lt;variable&gt;</code>. So let&#39;s watch the variables we care about (<code>i</code> and <code>fibseries</code>) with the following two commands:</p>
<pre><code class="lang-shell">+:i

+:fibseries
</code></pre>
<p>After each command, the current value of the variable will display. But once done, we&#39;ll get a persistent display of the variables and their values.</p>
</li>
<li><p>Press <code>Enter</code> to move to the next instruction:</p>
<pre><code> 9:
10:     // set 1st and 2nd entries
11:     fibseries.push(1);
        ^^^^^^^^^^^^^^^^^

:i
  0

:fibseries
  []
</code></pre><p>Notice that after the current instruction, the watched variables are displayed automatically.</p>
</li>
<li><p>You can also watch expressions, not just variables. Run the following expression to make our output a little more compact.</p>
<pre><code class="lang-shell">+:{ i, fibseries }
</code></pre>
<p>This will output as follows:</p>
<pre><code>{ i: 0, fibseries: [] }
</code></pre></li>
<li><p>Since we have all we need in this one expression, we can unwatch the individual variables. The syntax to watch a variable is <code>-:&lt;variable&gt;</code>.</p>
<pre><code class="lang-shell">-:i

-:fibseries
</code></pre>
<p>Now we&#39;ll only be watching the single expression comprising the two variables.</p>
</li>
<li><p>Press <code>Enter</code> to move to the next instruction and see the output:</p>
<pre><code>10:     // set 1st and 2nd entries
11:     fibseries.push(1);
12:     fibseries.push(1);
        ^^^^^^^^^

:{ i, fibseries }
  { i: 0, fibseries: [ 1 ] }
</code></pre><p>Notice that we have now populated the first entry in the sequence.</p>
</li>
<li><p>Because the debugger steps through each instruction one at a time, it&#39;s going to take a long time to see results if we don&#39;t pick 
up our pace. Luckily, the debugger can &quot;step over&quot;, which steps over the current line, moving to the next line, as long as it&#39;s at the same function depth. This will allow us to make progress much more quickly. So type <code>o</code> to step over the current instruction set. The output will be:</p>
<pre><code>13:
14:     // generate subsequent entries
15:     for (uint i=2; i &lt; n ; i++) {
                    ^

:{ i, fibseries }
  { i: 0, fibseries: [ 1, 1 ] }
</code></pre><p>Here we see that we have populated the first two entries in the sequence.</p>
</li>
<li><p>Since <code>Enter</code> will replay the previous command, press <code>Enter</code> now to step over again:</p>
<pre><code>14:     // generate subsequent entries
15:     for (uint i=2; i &lt; n ; i++) {
16:       fibseries.push(fibseries[i-1] + fibseries[i-2]);
          ^^^^^^^^^

:{ i, fibseries }
  { i: 2, fibseries: [ 1, 1 ] }
</code></pre><p>Now that we have two entries in our sequence, we&#39;ve moved into our for loop.</p>
</li>
<li><p>Continue pressing <code>Enter</code> and watching the variable output. You should notice that when <code>i</code> gets to <code>10</code>, the for loop ends (as the loop terminates at <code>i &lt; n</code>). The final array is:</p>
<pre><code>[1, 1, 2, 3, 5, 8, 13, 21, 34, 55] 
</code></pre><p>It can be verified that this is the correct first ten entries in the Fibonacci sequence.</p>
</li>
</ol>

    <h2 class="link-markdown">
      <a href="#debugging-unexpected-output" name="debugging-unexpected-output"><i class="fas fa-link"></i></a>
      Debugging unexpected output
    </h2>
  <p>Our contract as we have created it is working as expected. That&#39;s great, but we can&#39;t always get so lucky. Sometimes a contract appears to work fine (no errors are thrown) but the output is not what you&#39;d expect. Let&#39;s examine that here.</p>
<p>It&#39;s amazing what switching a plus sign for a minus sign can do. Instead of the Fibonacci sequence:</p>
<pre><code>F[1] = 1
F[2] = 1
F[n] = F[n-1] + F[n-2]
</code></pre><p>Let&#39;s switch the plus for a minus sign:</p>
<pre><code>F[1] = 1
F[2] = 1
F[n] = F[n-1] - F[n-2]
</code></pre><p>(I don&#39;t know if this series has a name, so we&#39;ll just call it the &quot;Trufflenacci&quot; sequence.)</p>
<p>Let&#39;s edit our contract and see what happens.</p>
<ol>
<li><p>Open the Fibonacci.sol file. Edit the definition of our <code>fibseries[]</code> array to be of type <code>uint8[]</code>.</p>
<pre><code class="lang-javascript">uint8[] fibseries;
</code></pre>
<p class="alert alert-info">
 <strong>Note</strong>: A <code>uint8</code> is an unsigned integer with 8 bits, with a maximum value of 2^8 = 255. Compare this to a <code>uint</code>, which is a 256 bit number with a maximum value of 2^256.
</p>
</li>
<li><p>Edit the for loop so that the terms are subtracted instead of added:</p>
<pre><code class="lang-javascript">fibseries.push(fibseries[i-1] - fibseries[i-2]);
</code></pre>
</li>
<li><p>Save this file.</p>
</li>
<li><p>Back on the console, recompile the contract.</p>
<pre><code class="lang-shell">compile --all
</code></pre>
<p class="alert alert-info">
 <strong>Note</strong>: The <code>--all</code> flag with force recompile all of the contracts.
</p>
</li>
<li><p>Remigrate the contract to the blockchain.</p>
<pre><code class="lang-shell">migrate --reset
</code></pre>
</li>
<li><p>We can now run the same command as before, which will generate a new transaction:</p>
<pre><code class="lang-shell">Fibonacci.deployed().then(function(instance){return instance.generateFib(10);});
</code></pre>
<p>As before, the output of the console will be the transaction details. Note the transaction hash (the value of <code>tx:</code>).</p>
</li>
<li><p>Type <code>debug</code> and then the value of <code>tx:</code> found in your transaction details. This will enter the debugger again.</p>
<pre><code>Fibonacci.sol:

1: pragma solidity ^0.4.22;
2:
3: contract Fibonacci {
   ^^^^^^^^^^^^^^^^^^^^
</code></pre></li>
<li><p>We&#39;re curious about what our <code>fibseries</code> array is going to look like, so let&#39;s watch it:</p>
<pre><code class="lang-shell">+:fibseries
</code></pre>
<p>The response will be <code>undefined</code>, because we haven&#39;t yet gotten to the point in the code where that array was defined.</p>
</li>
<li><p>Let&#39;s &quot;step over&quot; execution, so as to speed things up (&quot;step next&quot; takes much longer, as it&#39;s a more granular process). You can &quot;step over&quot; by running the <code>o</code> command.</p>
<pre><code>Fibonacci.sol:

6:
7:   // n = how many in the series to return
8:   function generateFib(uint n) public {
     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

:fibseries
  []
</code></pre><p>The array is defined, but is still empty.</p>
</li>
<li><p>Since <code>Enter</code> repeats the previous command (in our case, &quot;step over&quot;), press Enter twice. You&#39;ll see that the first element of <code>fibseries</code> has been populated.</p>
<pre><code>10:     // set 1st and 2nd entries
11:     fibseries.push(1);
12:     fibseries.push(1);
        ^^^^^^^^^

:fibseries
  [ 1 ]
</code></pre></li>
<li><p>Keep pressing Enter until four elements have been populated:</p>
<pre><code>:fibseries
  [ 1, 1, 0, 255 ]
</code></pre></li>
</ol>
<p>Something seems off here. Obviously, if you were expecting the Fibonacci series, by this point you would realize that you had veered far off course.</p>
<p>But the jump from <code>0</code> to <code>255</code> should be suspicious too. And in fact, what we&#39;re seeing is a <strong>buffer underflow</strong>, a situation where we have an <a href="https://en.wikipedia.org/wiki/Integer_(computer_science)">unsigned integer</a>, which can hold only positive values, being set to less than zero. Specifically, that fourth value is defined as the difference between the previous two elements, so <code>0 - 1 = -1</code>. Our type is <code>uint8[]</code> which means that each integer in the array is defined by 8 bits, so its maximum value is 2^8 - 1 = 255. Subtract one from zero, and the value &quot;wraps around&quot; to its maximum value.</p>
<p>Assuming this was the series we wanted (and that our minus sign was correct), the way to change this is to change the definition of our <code>fibseries</code> array from <code>uint8[]</code> to <code>int8[]</code>. That would make values &quot;signed integers&quot; and able to accept negative values, giving you an array that would look like this instead:</p>
<pre><code>[ 1, 1, 0, -1 ]
</code></pre>
    <h2 class="link-markdown">
      <a href="#debugging-errors" name="debugging-errors"><i class="fas fa-link"></i></a>
      Debugging errors
    </h2>
  <p>Sometimes, contracts have errors in them. They may compile just fine, but when you go to use them, problems arise.</p>
<p>This is one of the reasons to use Ganache over a public testnet: you can easily redeploy a contract without any penalty in time or ether.</p>
<p>So we&#39;re going to introduce a small error, a misnumbering in our for loop that will cause it to have an invalid index.</p>
<ol>
<li><p>Open the <code>Fibonacci.sol</code> file again. </p>
</li>
<li><p>Edit the for loop so that the <code>i</code> variable starts from <code>1</code></p>
<pre><code class="lang-javascript">for (uint i=1; i &lt; n ; i++) {
</code></pre>
</li>
<li><p>Save this file.</p>
</li>
<li><p>Back on the console, recompile the contract.</p>
<pre><code class="lang-shell">compile --all
</code></pre>
</li>
<li><p>Remigrate the contract to the blockchain.</p>
<pre><code class="lang-shell">migrate --reset
</code></pre>
</li>
<li><p>Run the same command as before:</p>
<pre><code class="lang-shell">Fibonacci.deployed().then(function(instance){return instance.generateFib(10);});
</code></pre>
<p>You&#39;ll see an error, which will start with this:</p>
<pre><code>Error: VM Exception while processing transaction: invalid opcode
</code></pre><p>Well that&#39;s not good. Moreover, the output didn&#39;t give us a transaction ID to debug, so we&#39;re going to need to look elsewhere for it. Thankfully, Ganache can tell us the transaction information.</p>
</li>
<li><p>Go back in Ganache and click the &quot;Logs&quot; link at the top:</p>
<p>
    <img class="img-fluid" src="/img/tutorials/debugger-variable/debugvar-ganache-logsbutton.png" title="Ganache logs button" alt="Ganache logs button" />
    
  </p>
<p><em>Click this button to open the logs</em></p>
</li>
<li><p>At the very bottom of the logs, you will see a transaction ID listed near an error saying <code>invalid opcode</code>. This is the one we need. Copy this transaction ID.</p>
<p>
    <img class="img-fluid" src="/img/tutorials/debugger-variable/debugvar-ganache-logs.png" title="Ganache logs" alt="Ganache logs" />
    
  </p>
<p><em>Ganache logs</em></p>
</li>
<li><p>Back in the console, type <code>debug</code> and paste in the transaction ID. This will enter the debugger again.</p>
</li>
<li><p>Let&#39;s watch the same compacted expression as before, showing both the value of <code>i</code> and the value of <code>fibseries</code>.</p>
<pre><code class="lang-shell">+:{ i, fibseries }
</code></pre>
</li>
<li><p>Continually step next. You will eventually reach a state where the debugger will error out.</p>
<pre><code>14:     // generate subsequent entries
15:     for (uint i=1; i &lt; n ; i++) {
16:       fibseries.push(fibseries[i-1] - fibseries[i-2]);
                                          ^^^^^^^^^^^^^^

:{ i, fibseries }
  { i: 1, fibseries: [ 1, 1 ] }

debug(development:0x948da9db...)&gt;

Transaction halted with a RUNTIME ERROR.

This is likely due to an intentional halting expression, like assert(), require() or revert(). It can also be due to out-of-gas exceptions. Please inspect your transaction parameters and contract code to determine the meaning of this error.
</code></pre><p>Note that the contract is failing at the point where it tries to determine the value of <code>fibseries[i-2]</code> But in our debugger, we know that the current value of <code>i</code> is <code>1</code>, so <code>i-2</code> is going to be <code>-1</code> (or actually <code>2^256 - 1</code>, due to the buffer underflow issue we talked about above, and with <code>i</code> defined as a <code>uint</code>). Since either one of those values are invalid (you can&#39;t have a negative index, and the value at index <code>2^256 - 1</code> is clearly not defined), the contract halts with an error.</p>
</li>
</ol>
<p>These are just some of the ways that you can use variable inspection to debug your contracts. We&#39;re constantly adding functionality of the debugger, so please <a href="https://github.com/trufflesuite/truffle">raise an issue on our Github page</a> or ask a fellow Truffler in our <a href="https://gitter.im/ConsenSys/truffle">community Gitter channel</a>. Happy debugging!</p>


            <div class="contribute-link">
              See a way to make this page better? <a href="https://github.com/trufflesuite/trufflesuite.com/edit/master/src/tutorials">Edit here &raquo;</a>
            </div>          </div>
        </div>
      </div>
    </main>

    <footer>
      <div class="container">
        <div class="row">
          <div class="col-12 col-md-2 mb-4 mb-md-0">
            <img class="truffle-logo" src="/img/truffle-logo-light.svg" alt="Truffle Logo" />
          </div>
    
          <div class="col-12 col-md-5 mb-3 mb-md-0">
            <ul>
              <!--<li><a href="/careers">CAREERS</a></li>-->
              <li><a href="mailto:inquiry@trufflesuite.com">CONTACT US</a></li>
              <li><a href="/policy">PRIVACY POLICY</a></li>
              <li><a href="/dashboard">DASHBOARD</a></li>
              <li><a href="https://github.com/trufflesuite">GITHUB</a></li>
              <li><a href="https://twitter.com/trufflesuite">TWITTER</a></li>
              <li><a class="trufflecon-link" href="/trufflecon2018">TRUFFLEC<img src="/img/truffle-logomark.svg" alt="Truffle Logo" /><span>O</span>N 2018</a></li>
              <li class="text-truffle">
                <a href="https://new.consensys.net/">
                  <img class="consensys-logomark" src="/img/consensys-logomark.svg" alt="ConsenSys Logo" />
                  &copy; CONSENSYS 2018
                </a>
              </li>
            </ul>
          </div>
    
          <div class="col-12 col-md-5">
            <h4>SIGN UP FOR THE TRUFFLE MAILING LIST</h4>
            <form>
              <div class="form-group">
                <input type="email" class="form-control" id="footerMailingEmail" placeholder="Email Address">
              </div>
              <div class="form-group">
                <input type="text" class="form-control" id="footerMailingFirstName" placeholder="First Name">
                <small id="firstNameHelp" class="form-text text-muted">So we know how to address you.</small>
              </div>
              <button type="submit" class="btn btn-truffle">SUBSCRIBE</button>
            </form>
          </div>
        </div>
      </div>
    </footer>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script>window.jQuery || document.write('<script src="/js/vendor/jquery-3.2.1.slim.min.js"><\/script>')</script>
    <script src="/js/bootstrap.min.js"></script>
    <script src="/js/vendor/prism.js"></script>
    <script src="/js/markdown-cleanup.js"></script>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-83874933-3', 'auto');
      ga('send', 'pageview');
    </script>  </body>
</html>